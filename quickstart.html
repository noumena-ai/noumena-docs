<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quick Start &#8212; noumena-tql  documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/noumena.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/noumena.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Importing Data Into TQL" href="importing-data.html" />
    <link rel="prev" title="TQL Terminology and Data Processing Model" href="concepts.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="overview.html">
          Noumena TQL</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="overview.html">Overview</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="overview.html">Programming Guides <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="overview.html">   Overview</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html#what-is-tql">What is TQL?</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#features">Features:</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#data-processing-model">Data Processing Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#installation">Installation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="overview.html#where-to-next">Where To Next?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">   Key Concepts and Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="concepts.html#timeseries">TimeSeries</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts.html#timelines">Timelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts.html#query">Query</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts.html#resultset">ResultSet</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts.html#metrics">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts.html#sampling">Sampling</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">   Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#demo-projects">Demo Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#importing-tql">Importing TQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-your-first-query">Writing Your First Query</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-tql-expression-language">The TQL Expression Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="#column-naming-and-typing">Column Naming and Typing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="importing-data.html">   Importing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="expression-language.html">   Expression Language</a><ul>
<li class="toctree-l2"><a class="reference internal" href="expression-language.html#literals">Literals</a></li>
<li class="toctree-l2"><a class="reference internal" href="expression-language.html#event-attributes">Event Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="expression-language.html#booleans-and-logical-operators">Booleans and Logical Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="expression-language.html#math-functions">Math Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="expression-language.html#statistics-random-numbers-and-hashing">Statistics, Random Numbers, and Hashing</a></li>
<li class="toctree-l2"><a class="reference internal" href="expression-language.html#string-manipulation">String Manipulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="expression-language.html#date-time-manipulation">Date/Time Manipulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="expression-language.html#array-manipulation">Array Manipulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="expression-language.html#local-variables-and-multi-statement-expressions">Local Variables and Multi-Statement Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="expression-language.html#timeline-scanning-operations">Timeline Scanning Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="expression-language.html#the-predict-function">The PREDICT Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="expression-language.html#the-set-property-function">The SET_PROPERTY Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="expression-language.html#comments">Comments</a></li>
<li class="toctree-l2"><a class="reference internal" href="expression-language.html#user-defined-functions-udfs">User Defined Functions (UDFs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="expression-language.html#compile-and-runtime-error-handling">Compile and Runtime Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="expression-language.html#tql-expression-debugger">TQL Expression Debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="expression-language.html#where-to-next">Where To Next?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="writing-queries.html">   Writing Queries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="writing-queries.html#the-downsample-by-operator">The downsample_by() Operator</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing-queries.html#the-options-operator">The options() Operator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="user-defined-functions.html">   User Defined Functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="user-defined-functions.html#table-level-udfs">Table-level UDFs</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-defined-functions.html#query-level-udfs">Query-level UDFs</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-defined-functions.html#inline-expression-udfs">Inline expression UDFs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">   Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#the-noumena-tql-configuration-file">The Noumena TQL Configuration File</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#modifying-the-configuration">Modifying the Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#configuration-properties">Configuration Properties:</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#install-additional-noumena-jupyter-notebook-content">Install Additional Noumena Jupyter Notebook Content</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="tex2jax_ignore mathjax_ignore section" id="quick-start">
<h1>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h1>
<p>TQL is a scalable data processing engine for machine learning applications.  In this article we will learn to write a TQL query that prepares data for a machine learning application, trains a ML model, then uses TQL to make batch predictions.</p>
<div class="section" id="demo-projects">
<h2>Demo Projects<a class="headerlink" href="#demo-projects" title="Permalink to this headline">¶</a></h2>
<p>For this tutorial we will be using TQL’s built in demo projects, which come automatically installed with TQL and are provided to help learn TQL before adding your own data.  For this guide we will use demo project 4, also known as <strong>Lethe</strong>.  Lethe represents a collection of advertising funnel data from three time series:</p>
<ul class="simple">
<li><p><strong>bids</strong> - online advertising auctions.  Some of those actions were won, producing impressions.</p></li>
<li><p><strong>activity</strong> - website activity, including page visits, product views, and purchases.  We hypothesize that some of this site activity was driven by our advertising campaign.</p></li>
<li><p><strong>user</strong> - a set of user demographic information (age, etc)</p></li>
</ul>
<p>We will be using Lethe in this guide to prepare a dataset for machine learning that attempts to predict the effect of showing ads on purchases.</p>
</div>
<div class="section" id="importing-tql">
<h2>Importing TQL<a class="headerlink" href="#importing-tql" title="Permalink to this headline">¶</a></h2>
<p>Always start your work by importing TQL into your namespace.  If a TQL backend is not yet running, one will be automatically started.  Learn more about configuring the TQL backend <span class="xref myst">here</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">noumena.tql</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>------------------------------------------------------------------
           Version: 20.1.16-SNAPSHOT
 Version Timestamp: 2021-07-21 17:34:23
       Version Age: 7 days, 20 hours, 20 minutes
   Filesystem Root: /Users/zkozick/.noumena/files
 Working Directory: /Users/zkozick/.noumena
Configuration File: /Users/zkozick/.noumena/noumena_conf.yml
       Api Gateway: http://localhost:9000
    Service Status: Icarus: ONLINE, Daedalus: ONLINE
    Service Uptime: 1 days, 1 hours, 55 minutes, 59 seconds
------------------------------------------------------------------
</pre></div>
</div>
</div>
<div class="section" id="writing-your-first-query">
<h2>Writing Your First Query<a class="headerlink" href="#writing-your-first-query" title="Permalink to this headline">¶</a></h2>
<p>TQL provides a simple SQL-like interface in Python for writing queries that produce datasets.  Queries always start with the <code class="docutils literal notranslate"><span class="pre">select()</span></code> function, usually is followed by a <code class="docutils literal notranslate"><span class="pre">from_events</span></code> clause.  There are also other common SQL-like interfaces such as <code class="docutils literal notranslate"><span class="pre">where()</span></code> and <code class="docutils literal notranslate"><span class="pre">limit()</span></code>.  Lets start by selecting all the bid attributes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;bid.*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">from_events</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<h4><em>Query results:</em></h4>partition "_default"
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe tex2jax_ignore">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>_c0</th>
      <th>bid_ad_size</th>
      <th>bid_bid</th>
      <th>bid_event_time</th>
      <th>bid_ghosted</th>
      <th>bid_request_id</th>
      <th>bid_user_id</th>
      <th>bid_won</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>user</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>bid</td>
      <td>big</td>
      <td>1.0</td>
      <td>2021-01-02 00:02:36</td>
      <td>false</td>
      <td>r13260</td>
      <td>u252</td>
      <td>true</td>
    </tr>
    <tr>
      <th>2</th>
      <td>bid</td>
      <td>big</td>
      <td>1.0</td>
      <td>2021-01-02 00:16:41</td>
      <td>false</td>
      <td>r13376</td>
      <td>u252</td>
      <td>true</td>
    </tr>
    <tr>
      <th>3</th>
      <td>bid</td>
      <td>small</td>
      <td>1.0</td>
      <td>2021-01-02 00:30:55</td>
      <td>false</td>
      <td>r13509</td>
      <td>u252</td>
      <td>true</td>
    </tr>
    <tr>
      <th>4</th>
      <td>activity</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div><i>query produced 5 rows x 8 columns in 0.32 seconds</i><br><br>
<p>Notice that some of the rows are empty for bid.  This is because some of the timeline events are not bids, but other types of events.  As you can see in the above result set, the type of each output row can be determined by referencing the special attribute <code class="docutils literal notranslate"><span class="pre">type</span></code>.</p>
<p>Lets start building up our machine learning dataset query by selecting a few attributes of the bid time series.  Event attributes are addressable by using <code class="docutils literal notranslate"><span class="pre">timeseries_name</span></code>.<code class="docutils literal notranslate"><span class="pre">attribute_name</span></code> syntax, for example <code class="docutils literal notranslate"><span class="pre">bid.ad_size</span></code>.  Lets also exclude non-bid events from our query using a <code class="docutils literal notranslate"><span class="pre">where()</span></code> clause:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;bid.ad_size&#39;</span><span class="p">,</span> <span class="s1">&#39;bid.bid&#39;</span><span class="p">,</span> <span class="s1">&#39;bid.ghosted&#39;</span><span class="p">,</span> <span class="s1">&#39;bid.won&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">from_events</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;type == &quot;bid&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<h4><em>Query results:</em></h4>partition "_default"
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe tex2jax_ignore">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>_c0</th>
      <th>_c1</th>
      <th>_c2</th>
      <th>_c3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>big</td>
      <td>1.0</td>
      <td>false</td>
      <td>true</td>
    </tr>
    <tr>
      <th>1</th>
      <td>big</td>
      <td>1.0</td>
      <td>false</td>
      <td>true</td>
    </tr>
    <tr>
      <th>2</th>
      <td>small</td>
      <td>1.0</td>
      <td>false</td>
      <td>true</td>
    </tr>
    <tr>
      <th>3</th>
      <td>small</td>
      <td>1.0</td>
      <td>false</td>
      <td>true</td>
    </tr>
    <tr>
      <th>4</th>
      <td>big</td>
      <td>1.0</td>
      <td>false</td>
      <td>true</td>
    </tr>
  </tbody>
</table>
</div><i>query produced 5 rows x 4 columns in 0.56 seconds</i><br><br>
<p>Notice that every row now has non-null values, since every row in the result set is from a bid event.</p>
</div>
<div class="section" id="the-tql-expression-language">
<h2>The TQL Expression Language<a class="headerlink" href="#the-tql-expression-language" title="Permalink to this headline">¶</a></h2>
<p>The strings passed to <code class="docutils literal notranslate"><span class="pre">select()</span></code> are actually TQL Expressions.  The Expression Language provides a susinct, efficient way of expressing a transformation from a time series event object such as bid to a piece of output data, like ad size.  This process, often referred to as data cleaning or data wrangling, can be extremely time consuming and is one of the things that TQL aims to make easy.  For example, lets make some simple transformations:</p>
<ol class="simple">
<li><p>perhaps our time series data contains a mix of lower and upper-case ad sizes.  We can normalize them using the simple expression language function <code class="docutils literal notranslate"><span class="pre">UPPER()</span></code>.</p></li>
<li><p>we also know that bids were in dollars, but we wish to rescale them into cents, by multiplying them by 100:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span>
  <span class="s1">&#39;UPPER(bid.ad_size)&#39;</span><span class="p">,</span> 
  <span class="s1">&#39;bid.bid * 100&#39;</span><span class="p">,</span> 
  <span class="s1">&#39;bid.ghosted&#39;</span><span class="p">,</span> 
  <span class="s1">&#39;bid.won&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">from_events</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;type == &quot;bid&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<h4><em>Query results:</em></h4>partition "_default"
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe tex2jax_ignore">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>_c0</th>
      <th>_c1</th>
      <th>_c2</th>
      <th>_c3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>BIG</td>
      <td>100.0</td>
      <td>false</td>
      <td>true</td>
    </tr>
    <tr>
      <th>1</th>
      <td>BIG</td>
      <td>100.0</td>
      <td>false</td>
      <td>true</td>
    </tr>
    <tr>
      <th>2</th>
      <td>SMALL</td>
      <td>100.0</td>
      <td>false</td>
      <td>true</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SMALL</td>
      <td>100.0</td>
      <td>false</td>
      <td>true</td>
    </tr>
    <tr>
      <th>4</th>
      <td>BIG</td>
      <td>100.0</td>
      <td>false</td>
      <td>true</td>
    </tr>
  </tbody>
</table>
</div><i>query produced 5 rows x 4 columns in 0.46 seconds</i><br><br>
<div class="section" id="timeline-expressions">
<h3>Timeline Expressions<a class="headerlink" href="#timeline-expressions" title="Permalink to this headline">¶</a></h3>
<p>Because of TQL’s unique data processing model, the entire context of the timeline is available to each event at extraction time, using the special variable <code class="docutils literal notranslate"><span class="pre">timeline</span></code>.  Each timeline has an id, accessible by <code class="docutils literal notranslate"><span class="pre">timeline.id</span></code>, as well as an array of events, accessible by <code class="docutils literal notranslate"><span class="pre">timeline.events</span></code>.  Through the expression language, we can easily express complex operations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span>
  <span class="s1">&#39;timeline.id&#39;</span><span class="p">,</span> <span class="c1">#the id of each timeline </span>
  <span class="s1">&#39;size(timeline.events)&#39;</span><span class="p">,</span> <span class="c1">#the total number of events on the timeline</span>
  <span class="s1">&#39;timeline.events[0].type&#39;</span> <span class="c1">#the type of the first event</span>
<span class="p">)</span><span class="o">.</span><span class="n">from_events</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<h4><em>Query results:</em></h4>partition "_default"
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe tex2jax_ignore">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>_c0</th>
      <th>_c1</th>
      <th>_c2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>u252</td>
      <td>548.0</td>
      <td>user</td>
    </tr>
    <tr>
      <th>1</th>
      <td>u252</td>
      <td>548.0</td>
      <td>user</td>
    </tr>
    <tr>
      <th>2</th>
      <td>u252</td>
      <td>548.0</td>
      <td>user</td>
    </tr>
  </tbody>
</table>
</div><i>query produced 3 rows x 3 columns in 0.3 seconds</i><br><br>
<p>It starts toget more interesting when you use <code class="docutils literal notranslate"><span class="pre">MAP</span></code> and <code class="docutils literal notranslate"><span class="pre">FILTER</span></code> operations to compare the timeline events to the current event.  Say, for example, we wanted to create a dataset that for each purchase, counted the number of bid events that occured prior to that purchase.  This would be quite a difficult operation to perform with SQL, but with TQL it’s easy:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span>
  <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="c1">#the type of the row: each row in this result set will be of type &#39;activity&#39;</span>
  <span class="s1">&#39;activity.conversion&#39;</span><span class="p">,</span> <span class="c1">#the activity type: each row in this result set will be of conversion &#39;purchase&#39;</span>
  <span class="s1">&#39;DATETIME(timestamp)&#39;</span><span class="p">,</span> <span class="c1">#the timestamp of this activity</span>
  <span class="s1">&#39;SIZE(FILTER(timeline.events, (x) -&gt; x.type == &quot;bid&quot; and x.timestamp &lt; timestamp))&#39;</span> <span class="c1">#the number of bids before each purchase</span>
<span class="p">)</span><span class="o">.</span><span class="n">from_events</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;type == &quot;activity&quot; and activity.conversion == &quot;purchase&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<h4><em>Query results:</em></h4>partition "_default"
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe tex2jax_ignore">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>_c0</th>
      <th>_c1</th>
      <th>_c2</th>
      <th>_c3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>activity</td>
      <td>purchase</td>
      <td>2021-01-04 22:12:46</td>
      <td>46.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>activity</td>
      <td>purchase</td>
      <td>2021-01-06 04:27:21</td>
      <td>55.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>activity</td>
      <td>purchase</td>
      <td>2021-01-06 13:12:13</td>
      <td>64.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>activity</td>
      <td>purchase</td>
      <td>2021-01-12 14:56:17</td>
      <td>254.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>activity</td>
      <td>purchase</td>
      <td>2021-01-12 15:52:32</td>
      <td>259.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>activity</td>
      <td>purchase</td>
      <td>2021-01-01 02:34:59</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>activity</td>
      <td>purchase</td>
      <td>2021-01-01 16:19:23</td>
      <td>36.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>activity</td>
      <td>purchase</td>
      <td>2021-01-08 15:57:31</td>
      <td>116.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>activity</td>
      <td>purchase</td>
      <td>2021-01-10 12:59:08</td>
      <td>173.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>activity</td>
      <td>purchase</td>
      <td>2021-01-10 15:56:29</td>
      <td>176.0</td>
    </tr>
  </tbody>
</table>
</div><i>query produced 10 rows x 4 columns in 0.36 seconds</i><br><br>
</div>
</div>
<div class="section" id="column-naming-and-typing">
<h2>Column Naming and Typing<a class="headerlink" href="#column-naming-and-typing" title="Permalink to this headline">¶</a></h2>
<p>In TQL, columns can be assigned names, and can be cast to different machine learning types, and will be treated differently by the query engine during extraction.  TQL provides the following casting functions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">label(expr,</span> <span class="pre">name)</span></code>: identifies the column as the ML result set label.  All values of this column are assumed to be numeric.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">weight(expr,</span> <span class="pre">name)</span></code>: identifies the column as the ML result set weight.  All values of this column are assumed to be numeric.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tag(expr,</span> <span class="pre">name)</span></code>: tag is a unique identifier for each row.  While not required, it is encouraged that you include a tag for debugging purposes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">categorical(expr,</span> <span class="pre">name)</span></code>:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span>
  <span class="n">label</span><span class="p">(</span><span class="s1">&#39;bid.bid&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;bid_amt&#39;</span><span class="p">),</span>
  <span class="n">weight</span><span class="p">(</span><span class="s1">&#39;1.0&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;constant_weight&#39;</span><span class="p">),</span> 
  <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;event_id&#39;</span><span class="p">),</span> 
  <span class="n">categorical</span><span class="p">(</span><span class="s1">&#39;COALESCE(UPPER(bid.ad_size), &quot;&quot;)&#39;</span><span class="p">),</span>
  <span class="n">numerical</span><span class="p">(</span><span class="s1">&#39;SIZE(FILTER(timeline.events,  (x) -&gt; x.type == &quot;bid&quot; and x.timestamp &lt; timestamp))&#39;</span><span class="p">,</span> <span class="s1">&#39;prior_bid_count&#39;</span><span class="p">),</span>
  
<span class="p">)</span><span class="o">.</span><span class="n">from_events</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;type == &quot;bid&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<h4><em>Query results:</em></h4>partition "_default"
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe tex2jax_ignore">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bid_amt</th>
      <th>constant_weight</th>
      <th>event_id</th>
      <th>_c3</th>
      <th>prior_bid_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>51539616375</td>
      <td>BIG</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>51539616491</td>
      <td>BIG</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>51539616624</td>
      <td>SMALL</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>51539616852</td>
      <td>SMALL</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>51539617100</td>
      <td>BIG</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div><i>query produced 5 rows x 5 columns in 0.44 seconds</i><br><br>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/quickstart.md.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright Nanigans, 2021.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>